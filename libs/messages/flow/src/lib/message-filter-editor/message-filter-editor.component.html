<p-drawer
  header="Filter Messages"
  appendTo="body"
  [(visible)]="visible"
  [modal]="true"
  position="right"
  [style]="{ width: '900px', 'max-width': '90vw' }"
  (onHide)="onCancel()"
>
  <div>
    <div>
      <p-accordion [multiple]="true" [value]="['0', '1', '2']">
        <!-- System Properties -->
        <p-accordion-panel value="0">
          <p-accordion-header>
            <div class="filter-header">
              System Properties
              @let systemFilterTagValue = systemFilterTag();
              @if (systemFilterTagValue) {
                <p-tag>{{ systemFilterTagValue }}</p-tag>
              }
            </div>
          </p-accordion-header>
          <p-accordion-content>
            <div>
              @for (filter of filterForm.systemProperties().value();
                let index = $index;
                track index) {
                <div class="filter-line system-property-filter-line">
                  <lib-system-property-form
                    [formField]="filterForm.systemProperties[index]"
                    [removable]="true"
                    (removedPressed)="removeSystemPropertyFilter(index)"
                  />
                </div>
              }

              <p-button
                icon="pi pi-plus"
                label="Add System Property Filter"
                variant="outlined"
                (click)="addSystemPropertyFilter()"
              ></p-button>
            </div>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Application Properties -->
        <p-accordion-panel value="1">
          <p-accordion-header>
            <div class="filter-header">
              Application Properties
              @let applicationFilterTagValue = applicationFilterTag();
              @if (applicationFilterTagValue) {
                <p-tag>{{ applicationFilterTagValue }}</p-tag>
              }
            </div>
          </p-accordion-header>
          <p-accordion-content>
            @for (filter of filterForm.applicationProperties().value();
              let index = $index;
              track index) {
              <div class="filter-line application-property-filter-line">
                <lib-application-property-form
                  [formField]="filterForm.applicationProperties[index]"
                  [removable]="true"
                  (removedPressed)="removeApplicationPropertyFilter(index)"
                />
              </div>
            }

            <p-button
              icon="pi pi-plus"
              label="Add Application Property Filter"
              variant="outlined"
              (click)="addApplicationPropertyFilter()"
            ></p-button>
          </p-accordion-content>
        </p-accordion-panel>

        <!-- Body -->
        <p-accordion-panel value="2">
          <p-accordion-header>
            <div class="filter-header">
              Message Body
              @let bodyFilterTagValue = bodyFilterTag();
              @if (bodyFilterTagValue) {
                <p-tag>{{ bodyFilterTagValue }}</p-tag>
              }
            </div>
          </p-accordion-header>
          <p-accordion-content>
            @for (filter of filterForm.body().value();
              let index = $index;
              track index) {
              <div class="filter-line application-property-filter-line">
                <lib-body-property-form
                  [formField]="filterForm.body[index]"
                  [removable]="true"
                  (removedPressed)="removeBodyFilter(index)"
                />
              </div>
            }

            <p-button
              icon="pi pi-plus"
              label="Add body Filter"
              variant="outlined"
              (click)="addBodyFilter()"
            ></p-button>
          </p-accordion-content>
        </p-accordion-panel>
      </p-accordion>
    </div>
    <div class="actions">
      <p-button variant="text" (click)="onCancel()"> Cancel</p-button>
      <p-button severity="danger" (click)="onClearAll()"> Clear All</p-button>
      <p-button (click)="onApply()" [disabled]="!isFilterValid()">
        Apply
      </p-button>
    </div>
  </div>
</p-drawer>
